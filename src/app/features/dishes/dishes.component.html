<div class="p-4 max-w-4xl mx-auto">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-semibold flex items-center gap-3" style="color: var(--text-primary); letter-spacing: -0.02em;">
      Meine Gerichte
      <span class="text-base font-medium px-3 py-1 rounded-full" style="background-color: var(--bg-surface); color: var(--text-tertiary);">{{ dishCount() }} Gerichte</span>
    </h1>
  </div>

  <!-- Inline Form -->
  <form [formGroup]="dishForm" (ngSubmit)="saveDish()" class="mb-6 bg-surface rounded-xl shadow-card p-5">
    <div class="flex flex-col md:flex-row gap-3">
      <!-- Name Input -->
      <div class="flex-1">
        <input
          formControlName="name"
          type="text"
          placeholder="Neues Gericht..."
          class="w-full px-4 py-2.5 border rounded-lg focus:outline-none transition-all font-medium"
          style="background-color: var(--bg-elevated); border-color: var(--border-standard); color: var(--text-primary);"
          onfocus="this.style.borderColor='var(--brand-primary)'; this.style.boxShadow='0 0 0 3px var(--brand-subtle)';"
          onblur="this.style.borderColor='var(--border-standard)'; this.style.boxShadow='none';"
        />
        @if (dishForm.get('name')?.invalid && dishForm.get('name')?.touched) {
          <div class="text-sm mt-1.5" style="color: var(--error);">
            @if (dishForm.get('name')?.errors?.['required']) {
              Name ist erforderlich
            }
            @if (dishForm.get('name')?.errors?.['minlength']) {
              Name muss mindestens 2 Zeichen lang sein
            }
          </div>
        }
      </div>

      <!-- Category Select -->
      <div class="w-full md:w-48">
        <select
          formControlName="category"
          class="w-full px-4 py-2.5 border rounded-lg focus:outline-none transition-all font-medium"
          style="background-color: var(--bg-elevated); border-color: var(--border-standard); color: var(--text-primary);"
          onfocus="this.style.borderColor='var(--brand-primary)'; this.style.boxShadow='0 0 0 3px var(--brand-subtle)';"
          onblur="this.style.borderColor='var(--border-standard)'; this.style.boxShadow='none';"
        >
          <option value="">Kategorie w√§hlen</option>
          <option value="Fisch">üêü Fisch</option>
          <option value="Fleisch">ü•© Fleisch</option>
          <option value="Vegetarisch">ü•¨ Vegetarisch</option>
        </select>
        @if (dishForm.get('category')?.invalid && dishForm.get('category')?.touched) {
          <div class="text-sm mt-1.5" style="color: var(--error);">
            Kategorie ist erforderlich
          </div>
        }
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="px-6 py-2.5 text-white rounded-lg transition-colors font-semibold whitespace-nowrap flex items-center gap-2"
        style="background-color: var(--brand-primary);"
        onmouseover="this.style.backgroundColor='var(--brand-hover)'"
        onmouseout="this.style.backgroundColor='var(--brand-primary)'"
      >
        @if (editingDish()) {
          <lucide-icon [img]="Save" [size]="18"></lucide-icon>
          Speichern
        } @else {
          <lucide-icon [img]="Plus" [size]="18"></lucide-icon>
          Hinzuf√ºgen
        }
      </button>

      <!-- Cancel Button (only when editing) -->
      @if (editingDish()) {
        <button
          type="button"
          (click)="cancelEdit()"
          class="px-6 py-2.5 rounded-lg transition-colors font-medium flex items-center gap-2"
          style="background-color: var(--bg-surface); color: var(--text-secondary);"
          onmouseover="this.style.backgroundColor='var(--bg-surface-hover)'"
          onmouseout="this.style.backgroundColor='var(--bg-surface)'"
        >
          <lucide-icon [img]="X" [size]="18"></lucide-icon>
          Abbrechen
        </button>
      }
    </div>
  </form>

  <!-- Tab Bar -->
  <div role="tablist" class="flex gap-1 border-b mb-5 overflow-x-auto" style="border-color: var(--border-standard);">
    @for (tab of tabs; track tab.id) {
      <button
        role="tab"
        type="button"
        [attr.aria-selected]="activeTab() === tab.id"
        (click)="setTab(tab.id)"
        class="px-4 py-2.5 font-semibold whitespace-nowrap border-b-2 transition-colors tab-button"
        [class.active-tab]="activeTab() === tab.id"
        [class.inactive-tab]="activeTab() !== tab.id"
      >
        {{ tab.label }}
      </button>
    }
  </div>

  <!-- Search Field -->
  <div class="mb-6">
    <div class="relative">
      <input
        type="text"
        placeholder="Gerichte suchen..."
        (input)="updateSearch($event)"
        class="w-full px-4 py-2.5 pl-11 border rounded-lg focus:outline-none transition-all font-medium"
        style="background-color: var(--bg-elevated); border-color: var(--border-standard); color: var(--text-primary);"
        onfocus="this.style.borderColor='var(--brand-primary)'; this.style.boxShadow='0 0 0 3px var(--brand-subtle)';"
        onblur="this.style.borderColor='var(--border-standard)'; this.style.boxShadow='none';"
      />
      <!-- Search icon -->
      <lucide-icon
        [img]="Search"
        [size]="20"
        class="absolute left-3.5 top-1/2 -translate-y-1/2"
        style="color: var(--text-muted);"
      ></lucide-icon>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="text-center py-12 text-tertiary">
      Laden...
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="rounded-xl p-4 mb-4" style="background-color: var(--error-bg); border: 1px solid var(--error); color: var(--error);">
      {{ error() }}
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && filteredDishes().length === 0) {
    <div class="text-center py-16">
      @if (hasNoDishes()) {
        <div style="color: var(--text-tertiary);">
          <div class="text-6xl mb-4">üçΩÔ∏è</div>
          <p class="text-lg font-semibold mb-2" style="color: var(--text-secondary);">Noch keine Gerichte</p>
          <p style="color: var(--text-muted);">F√ºge dein erstes Gericht oben hinzu!</p>
        </div>
      } @else {
        <div style="color: var(--text-tertiary);">
          <div class="text-6xl mb-4">üîç</div>
          <p class="text-lg font-semibold" style="color: var(--text-secondary);">Keine Gerichte gefunden</p>
        </div>
      }
    </div>
  }

  <!-- Dish List -->
  @if (!isLoading() && filteredDishes().length > 0) {
    <div class="space-y-3">
      @for (dish of filteredDishes(); track dish.id) {
        <div class="bg-surface rounded-xl shadow-card p-4 hover:shadow-card-hover transition-all dish-card">
          <div class="flex items-center gap-3">
            <!-- Dish Name -->
            <div class="flex-1 font-semibold text-primary">
              {{ dish.name }}
            </div>

            <!-- Category Badge -->
            <span
              class="px-3 py-1.5 rounded-full text-sm font-semibold category-badge"
              [class.category-fish]="dish.category === 'Fisch'"
              [class.category-meat]="dish.category === 'Fleisch'"
              [class.category-veg]="dish.category === 'Vegetarisch'"
            >
              @if (dish.category === 'Fisch') { üêü }
              @if (dish.category === 'Fleisch') { ü•© }
              @if (dish.category === 'Vegetarisch') { ü•¨ }
              {{ dish.category }}
            </span>

            <!-- Favorite Toggle -->
            <button
              type="button"
              (click)="toggleFavorite(dish)"
              class="p-2 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center icon-button"
              [attr.aria-label]="dish.is_favorite ? 'Als Favorit entfernen' : 'Als Favorit markieren'"
            >
              <lucide-icon
                [img]="Heart"
                [size]="22"
                [class.text-red-500]="dish.is_favorite"
                [attr.fill]="dish.is_favorite ? 'currentColor' : 'none'"
                [style.color]="!dish.is_favorite ? 'var(--text-muted)' : ''"
              ></lucide-icon>
            </button>

            <!-- Edit Button -->
            <button
              type="button"
              (click)="startEdit(dish)"
              class="p-2 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center icon-button"
              aria-label="Gericht bearbeiten"
            >
              <lucide-icon [img]="Edit2" [size]="20" class="text-secondary"></lucide-icon>
            </button>

            <!-- Delete Button -->
            <button
              type="button"
              (click)="deleteDish(dish)"
              class="p-2 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center icon-button-danger"
              aria-label="Gericht l√∂schen"
            >
              <lucide-icon [img]="Trash2" [size]="20" style="color: var(--error);"></lucide-icon>
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>

<style>
  .active-tab {
    border-color: var(--brand-primary) !important;
    color: var(--brand-primary) !important;
  }

  .inactive-tab {
    border-color: transparent !important;
    color: var(--text-tertiary) !important;
  }

  .inactive-tab:hover {
    color: var(--text-secondary) !important;
  }

  .category-fish {
    background-color: var(--ocean-100);
    color: var(--ocean-600);
  }

  .category-meat {
    background-color: var(--coral-100);
    color: var(--coral-600);
  }

  .category-veg {
    background-color: var(--sage-100);
    color: var(--sage-600);
  }

  .icon-button:hover {
    background-color: var(--bg-surface-hover);
  }

  .icon-button-danger:hover {
    background-color: var(--error-bg);
  }
</style>
