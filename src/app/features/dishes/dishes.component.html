<div class="p-4 max-w-4xl mx-auto">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
      Meine Gerichte
      <span class="text-base font-normal text-gray-500">{{ dishCount() }} Gerichte</span>
    </h1>
  </div>

  <!-- Inline Form -->
  <form [formGroup]="dishForm" (ngSubmit)="saveDish()" class="mb-6 bg-white rounded-lg shadow-md p-4">
    <div class="flex flex-col md:flex-row gap-3">
      <!-- Name Input -->
      <div class="flex-1">
        <input
          formControlName="name"
          type="text"
          placeholder="Neues Gericht..."
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
        />
        @if (dishForm.get('name')?.invalid && dishForm.get('name')?.touched) {
          <div class="text-red-500 text-sm mt-1">
            @if (dishForm.get('name')?.errors?.['required']) {
              Name ist erforderlich
            }
            @if (dishForm.get('name')?.errors?.['minlength']) {
              Name muss mindestens 2 Zeichen lang sein
            }
          </div>
        }
      </div>

      <!-- Category Select -->
      <div class="w-full md:w-48">
        <select
          formControlName="category"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
        >
          <option value="">Kategorie w√§hlen</option>
          <option value="Fisch">Fisch</option>
          <option value="Fleisch">Fleisch</option>
          <option value="Vegetarisch">Vegetarisch</option>
        </select>
        @if (dishForm.get('category')?.invalid && dishForm.get('category')?.touched) {
          <div class="text-red-500 text-sm mt-1">
            Kategorie ist erforderlich
          </div>
        }
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium whitespace-nowrap"
      >
        @if (editingDish()) {
          Speichern
        } @else {
          Hinzuf√ºgen
        }
      </button>

      <!-- Cancel Button (only when editing) -->
      @if (editingDish()) {
        <button
          type="button"
          (click)="cancelEdit()"
          class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
        >
          Abbrechen
        </button>
      }
    </div>
  </form>

  <!-- Tab Bar -->
  <div role="tablist" class="flex gap-1 border-b border-gray-200 mb-4 overflow-x-auto">
    @for (tab of tabs; track tab.id) {
      <button
        role="tab"
        type="button"
        [attr.aria-selected]="activeTab() === tab.id"
        (click)="setTab(tab.id)"
        class="px-4 py-2 font-medium whitespace-nowrap border-b-2 transition-colors"
        [class.border-green-600]="activeTab() === tab.id"
        [class.text-green-600]="activeTab() === tab.id"
        [class.border-transparent]="activeTab() !== tab.id"
        [class.text-gray-600]="activeTab() !== tab.id"
        [class.hover:text-gray-800]="activeTab() !== tab.id"
      >
        {{ tab.label }}
      </button>
    }
  </div>

  <!-- Search Field -->
  <div class="mb-6">
    <div class="relative">
      <input
        type="text"
        placeholder="Gerichte suchen..."
        (input)="updateSearch($event)"
        class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
      />
      <!-- Magnifying glass icon -->
      <svg
        class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
        />
      </svg>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="text-center py-8 text-gray-500">
      Laden...
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 mb-4">
      {{ error() }}
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && filteredDishes().length === 0) {
    <div class="text-center py-12">
      @if (hasNoDishes()) {
        <div class="text-gray-500">
          <div class="text-5xl mb-4">üçΩÔ∏è</div>
          <p class="text-lg font-medium mb-2">Noch keine Gerichte</p>
          <p class="text-gray-400">F√ºge dein erstes Gericht oben hinzu!</p>
        </div>
      } @else {
        <div class="text-gray-500">
          <div class="text-5xl mb-4">üîç</div>
          <p class="text-lg font-medium">Keine Gerichte gefunden</p>
        </div>
      }
    </div>
  }

  <!-- Dish List -->
  @if (!isLoading() && filteredDishes().length > 0) {
    <div class="space-y-2">
      @for (dish of filteredDishes(); track dish.id) {
        <div class="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow">
          <div class="flex items-center gap-3">
            <!-- Dish Name -->
            <div class="flex-1 font-medium text-gray-800">
              {{ dish.name }}
            </div>

            <!-- Category Badge -->
            <span
              class="px-3 py-1 rounded-full text-sm font-medium"
              [class.bg-blue-100]="dish.category === 'Fisch'"
              [class.text-blue-800]="dish.category === 'Fisch'"
              [class.bg-red-100]="dish.category === 'Fleisch'"
              [class.text-red-800]="dish.category === 'Fleisch'"
              [class.bg-green-100]="dish.category === 'Vegetarisch'"
              [class.text-green-800]="dish.category === 'Vegetarisch'"
            >
              {{ dish.category }}
            </span>

            <!-- Favorite Toggle -->
            <button
              type="button"
              (click)="toggleFavorite(dish)"
              class="p-2 hover:bg-gray-100 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center"
              [attr.aria-label]="dish.is_favorite ? 'Als Favorit entfernen' : 'Als Favorit markieren'"
            >
              @if (dish.is_favorite) {
                <!-- Filled heart -->
                <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" />
                </svg>
              } @else {
                <!-- Outline heart -->
                <svg class="w-6 h-6 text-gray-400 hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              }
            </button>

            <!-- Edit Button -->
            <button
              type="button"
              (click)="startEdit(dish)"
              class="p-2 hover:bg-gray-100 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center"
              aria-label="Gericht bearbeiten"
            >
              <!-- Pencil icon -->
              <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
              </svg>
            </button>

            <!-- Delete Button -->
            <button
              type="button"
              (click)="deleteDish(dish)"
              class="p-2 hover:bg-red-50 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center"
              aria-label="Gericht l√∂schen"
            >
              <!-- Trash icon -->
              <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>
