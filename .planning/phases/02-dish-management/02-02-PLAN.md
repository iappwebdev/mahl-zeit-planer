---
phase: 02-dish-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - package.json
  - src/app/app.config.ts
  - src/app/features/dishes/dishes.component.ts
  - src/app/features/dishes/dishes.component.html
  - src/app/features/dishes/dishes.component.css
autonomous: true
user_setup:
  - service: supabase
    why: "Dishes table must exist before UI can persist data"
    dashboard_config:
      - task: "Run 002_dishes.sql migration in Supabase SQL Editor"
        location: "Supabase Dashboard -> SQL Editor -> paste contents of supabase/migrations/002_dishes.sql -> Run"

must_haves:
  truths:
    - "User can create a dish with name and category via inline form"
    - "User can edit existing dish name or category via inline form pre-filled with current values"
    - "User can delete dishes with immediate removal and Rückgängig undo toast"
    - "User can filter dish list by category tabs (Alle, Fisch, Fleisch, Vegetarisch, Favoriten)"
    - "User can search dishes by name within active tab"
    - "User can mark dishes as favorites with heart icon toggle"
    - "Dish list sorts favorites first, then alphabetical"
    - "Category badges show colored pills (blue=Fisch, red=Fleisch, green=Vegetarisch)"
    - "Empty state shows friendly German message when no dishes exist"
    - "Total dish count visible"
  artifacts:
    - path: "src/app/features/dishes/dishes.component.ts"
      provides: "Complete dish management UI logic with Signal-based state"
      min_lines: 100
    - path: "src/app/features/dishes/dishes.component.html"
      provides: "Dish list template with tabs, search, form, list rows"
      min_lines: 80
    - path: "package.json"
      provides: "Angular Material dependency"
      contains: "@angular/material"
  key_links:
    - from: "src/app/features/dishes/dishes.component.ts"
      to: "src/app/features/dishes/services/dish.service.ts"
      via: "inject(DishService)"
      pattern: "inject\\(DishService\\)"
    - from: "src/app/features/dishes/dishes.component.ts"
      to: "@angular/material/snack-bar"
      via: "inject(MatSnackBar)"
      pattern: "inject\\(MatSnackBar\\)"
    - from: "src/app/features/dishes/dishes.component.ts"
      to: "src/app/features/dishes/models/dish.model.ts"
      via: "import { Dish, DishCategory }"
      pattern: "import.*Dish.*from.*dish\\.model"
---

<objective>
Build the complete dish management UI: install Angular Material for snackbar, then implement the full dishes page with inline add/edit form, category tabs, search, favorite toggle, delete with undo, and empty state.

Purpose: This is the user-facing feature that delivers all 5 Phase 2 requirements (DISH-01 through DISH-05). The data layer from Plan 01 powers this UI.
Output: Working dish management page at `/gerichte` with full CRUD, filtering, search, and favorites.
</objective>

<execution_context>
@C:/Users/simon/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/simon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Plan 01 created these — must import/use them:
@.planning/phases/02-dish-management/02-01-SUMMARY.md
@src/app/features/dishes/models/dish.model.ts
@src/app/features/dishes/services/dish.service.ts

# Existing app shell and styling patterns:
@src/app/features/dishes/dishes.component.ts
@src/app/features/dishes/dishes.component.html
@src/app/shared/components/layout/layout.component.html
@src/app/app.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Angular Material and configure snackbar</name>
  <files>
    package.json
    src/app/app.config.ts
  </files>
  <action>
**Install Angular Material:**
Run `npx ng add @angular/material --skip-confirmation --theme=custom --animations=included --typography=false` (or `npm install @angular/material @angular/cdk @angular/animations` if `ng add` fails).

This adds `@angular/material`, `@angular/cdk`, and `@angular/animations` to package.json.

**Configure animations provider** in `src/app/app.config.ts`:
Add `provideAnimationsAsync()` from `@angular/platform-browser/animations/async` to the providers array. This is required for MatSnackBar animations.

The updated providers array should include:
```typescript
import { provideAnimationsAsync } from '@angular/platform-browser/animations/async';

providers: [
  provideBrowserGlobalErrorListeners(),
  provideRouter(routes),
  provideHttpClient(),
  provideAnimationsAsync()
]
```

Do NOT import any Angular Material theme CSS globally — we use Tailwind for all styling. MatSnackBar works with its own encapsulated styles.
  </action>
  <verify>
1. `@angular/material` appears in package.json dependencies
2. `@angular/cdk` appears in package.json dependencies
3. `provideAnimationsAsync` is in app.config.ts providers
4. `npx ng build --configuration=development` compiles without errors
  </verify>
  <done>
Angular Material installed with animations provider configured. MatSnackBar available for import in components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement complete dishes page with CRUD, filtering, favorites, and undo delete</name>
  <files>
    src/app/features/dishes/dishes.component.ts
    src/app/features/dishes/dishes.component.html
    src/app/features/dishes/dishes.component.css
  </files>
  <action>
Replace the placeholder dishes component with the full dish management UI. This is one component (not broken into sub-components) to keep it simple.

**Component class** (`dishes.component.ts`):

Imports needed: `Component, signal, computed, inject, OnInit, DestroyRef` from `@angular/core`, `takeUntilDestroyed` from `@angular/core/rxjs-interop`, `ReactiveFormsModule, FormBuilder, Validators` from `@angular/forms`, `MatSnackBar, MatSnackBarModule` from `@angular/material/snack-bar`, `DishService`, `Dish, DishCategory, CreateDishPayload` from models.

**State (Signals):**
- `private allDishes = signal<Dish[]>([])` — master dish list from DB
- `activeTab = signal<string>('alle')` — current filter tab
- `searchTerm = signal<string>('')` — search input value
- `isLoading = signal(false)` — loading indicator
- `error = signal<string | null>(null)` — error message
- `editingDish = signal<Dish | null>(null)` — dish being edited (null = add mode)

**Computed signals:**
- `filteredDishes = computed(...)` — applies tab filter + search filter + sort (favorites first, then alphabetical A-Z using `localeCompare('de')`)
  - Tab 'alle': show all
  - Tab 'favoriten': filter `is_favorite === true`
  - Tab 'Fisch'/'Fleisch'/'Vegetarisch': filter by category match
  - Search: case-insensitive `name.includes(searchTerm)`
- `dishCount = computed(() => this.filteredDishes().length)` — count for display

**Tabs definition:**
```typescript
readonly tabs = [
  { id: 'alle', label: 'Alle' },
  { id: 'Fisch', label: 'Fisch' },
  { id: 'Fleisch', label: 'Fleisch' },
  { id: 'Vegetarisch', label: 'Vegetarisch' },
  { id: 'favoriten', label: 'Favoriten' }
];
```

**Form:** Use FormBuilder to create a reactive form with:
- `name`: required, minLength(2)
- `category`: required

**Methods:**

`ngOnInit()` — call `loadDishes()`

`async loadDishes()` — set isLoading, try/catch getAll, set allDishes or error, finally clear isLoading

`async saveDish()` — if form invalid, mark all as touched and return. If editingDish is set, call `dishService.update(editingDish.id, form.value)` and update allDishes signal in-place. If not editing, call `dishService.create(form.value)` and add to allDishes. Reset form and editingDish after success. Wrap in try/catch, show error snackbar on failure.

`startEdit(dish: Dish)` — set editingDish signal, patch form with dish name and category

`cancelEdit()` — reset form, set editingDish to null

`async toggleFavorite(dish: Dish)` — call dishService.toggleFavorite(dish.id, !dish.is_favorite). Update the dish in allDishes signal in-place (optimistic: update signal first, revert on error).

`deleteDish(dish: Dish)` — **Optimistic delete with undo:**
  1. Remove dish from allDishes signal immediately
  2. Open MatSnackBar: message `"${dish.name}" gelöscht`, action text `'Rückgängig'`, duration 5000ms
  3. On `snackBarRef.onAction()` (pipe with `takeUntilDestroyed(this.destroyRef)`): restore dish back into allDishes
  4. On `snackBarRef.afterDismissed()` (pipe with `takeUntilDestroyed(this.destroyRef)`): if NOT `dismissedByAction`, call `dishService.delete(dish.id)`. If delete fails, restore dish and show error snackbar.

`setTab(tabId: string)` — set activeTab signal

`updateSearch(term: string)` — set searchTerm signal

**Template** (`dishes.component.html`):

Structure (top to bottom):

1. **Page header:** `<h1>` "Meine Gerichte" with dish count badge showing `dishCount()` (e.g., "12 Gerichte")

2. **Inline form** (always visible at top):
   - Horizontal row on desktop, stacked on mobile
   - Text input for dish name with placeholder "Neues Gericht..."
   - Select dropdown for category with options: Fisch, Fleisch, Vegetarisch (default empty option "Kategorie wählen")
   - Submit button: shows "Hinzufügen" in add mode, "Speichern" in edit mode
   - Cancel button: only visible when editing, resets form
   - Validation errors shown below fields in red (`text-red-500 text-sm`) only when field is touched and invalid

3. **Tab bar:** Horizontal tabs (flex, gap, border-bottom). Per locked decision:
   - Tabs: Alle | Fisch | Fleisch | Vegetarisch | Favoriten
   - Active tab: green bottom border (`border-green-600`) and green text
   - Inactive: transparent border, gray text, hover darker gray
   - Use `role="tablist"` and `role="tab"` for accessibility

4. **Search field:** Text input below tabs with placeholder "Gerichte suchen..." and magnifying glass icon or similar. Bind to `(input)` event calling `updateSearch($event.target.value)`.

5. **Loading state:** Show a simple "Laden..." text or spinner when `isLoading()` is true.

6. **Error state:** Show error message in red when `error()` is not null.

7. **Empty state:** When `filteredDishes().length === 0` AND not loading:
   - If `allDishes().length === 0` (truly empty): Show "Noch keine Gerichte — fuge dein erstes hinzu!" with a pointer to the form above
   - If allDishes has items but filter returns empty: Show "Keine Gerichte gefunden" (filter/search yielded no results)

8. **Dish list:** For each dish in `filteredDishes()`:
   - Row layout: dish name (text, flex-grow), category badge (colored pill), favorite heart button, edit button (pencil icon), delete button (trash icon)
   - **Category badge colors** (per locked decision examples, confirmed by Claude's discretion):
     - Fisch: `bg-blue-100 text-blue-800`
     - Fleisch: `bg-red-100 text-red-800`
     - Vegetarisch: `bg-green-100 text-green-800`
   - **Favorite toggle:** Heart icon button. Filled red heart (`text-red-500`) when `is_favorite`, outline gray heart (`text-gray-400 hover:text-red-500`) when not. Use inline SVG (Heroicons heart paths from research).
   - **Edit button:** Pencil/edit icon, calls `startEdit(dish)` on click
   - **Delete button:** Trash/X icon, calls `deleteDish(dish)` on click. Always visible (per locked decision: no hidden actions).
   - Rows should have subtle hover effect and padding for comfortable touch targets

**Styling** (`dishes.component.css`):
Keep minimal — use Tailwind utility classes in the template. Only add custom CSS if absolutely needed (e.g., for Angular Material snackbar overrides).

**Component decorator:**
- `imports`: `ReactiveFormsModule`, `MatSnackBarModule`, and any Angular common modules needed (`NgFor`, `NgIf`, etc. — or use `@if`/`@for` control flow which requires no imports)
- Use Angular 17+ control flow syntax (`@if`, `@for`, `@empty`) instead of `*ngIf`/`*ngFor` directives — this avoids needing CommonModule imports

**Responsive design:**
- Form: flex-row on desktop (`md:flex-row`), flex-col on mobile
- Tabs: horizontal scroll if needed on small screens (`overflow-x-auto`)
- List rows: comfortable padding, touch-friendly button sizes (min 44px)
- Page container: `p-4` padding, `max-w-4xl mx-auto` for centered content (matching existing layout pattern)

**Important implementation notes:**
- Use `@if`/`@for` control flow (Angular 17+), NOT `*ngIf`/`*ngFor` — avoids CommonModule import
- For inline SVGs (heart, pencil, trash), use Heroicons paths directly in the template
- German text throughout (per locked decision)
- No confirmation dialog on delete (per locked decision) — use undo snackbar only
  </action>
  <verify>
1. Files exist and are non-empty:
   - `src/app/features/dishes/dishes.component.ts` (100+ lines)
   - `src/app/features/dishes/dishes.component.html` (80+ lines)
2. Component imports DishService, MatSnackBar, ReactiveFormsModule (grep)
3. Component has all signals: allDishes, activeTab, searchTerm, isLoading, error, editingDish
4. Component has filteredDishes computed signal with sorting
5. Template contains tab buttons with all 5 tabs
6. Template contains inline form with name input and category select
7. Template contains search input
8. Template contains empty state messages in German
9. Template contains heart SVG for favorites
10. Template contains delete button on every row
11. Component uses takeUntilDestroyed for snackbar subscriptions
12. `npx ng build --configuration=development` compiles without errors
13. Run `npx ng serve` briefly to verify page loads at /gerichte without runtime errors
  </verify>
  <done>
Complete dish management page at /gerichte with: inline add/edit form, category tabs (Alle/Fisch/Fleisch/Vegetarisch/Favoriten), text search, favorite heart toggle, edit/delete actions per row, optimistic delete with "Rückgängig" undo snackbar, empty state messages in German, and dish count display. Sorted favorites-first then alphabetical.
  </done>
</task>

</tasks>

<verification>
1. Angular build compiles: `npx ng build --configuration=development`
2. Dev server starts: `npx ng serve`
3. Navigate to /gerichte — page loads without console errors
4. All German text visible (no English UI text)
5. Form shows with name input, category dropdown, and submit button
6. Tab bar shows all 5 tabs
7. Empty state message appears when no dishes exist
8. MatSnackBar available (animations provider configured)
</verification>

<success_criteria>
- All 5 Phase 2 requirements addressed:
  - DISH-01: Create dish with name + category via inline form
  - DISH-02: Edit dish via same inline form pre-filled with values
  - DISH-03: Delete dish with immediate removal + undo snackbar
  - DISH-04: Filter by category via tab bar + search by name
  - DISH-05: Mark/unmark favorites with heart icon toggle
- Page compiles and loads without errors
- German-only UI text
- Responsive design (mobile and desktop)
</success_criteria>

<output>
After completion, create `.planning/phases/02-dish-management/02-02-SUMMARY.md`
</output>
